#!/usr/bin/env bash
export CACHE_DIR="${XDG_CACHE_DIR:-$HOME/.cache}/bookmarks"
export CACHE_ROFI="$CACHE_DIR/rofi"

bindings=(
	-kb-custom-1 Alt+e
)
mesg="<b>${bindings[1]}</b>: edit"

#TODO:
#yank key combo
# set -e

open() {
	if [ -n "$1" ]; then
		bookmark open "$1"
	fi
}

edit() {
	if [ -n "$1" ]; then
		export BOOKMARK="$1"
		"$TERMINAL" -e sh -c 'bookmark edit "$BOOKMARK"'
	fi
}

on_rofi_exit() {
	case "$1" in
		0) open "$bookmark";;
		10) edit "$bookmark";;
		*) exit "$1";;
	esac
}

case "$1" in
	download) shift; rofi-bookmark-download.py "$@"; exit ;;
	*) ;;
esac

bookmark="$(rofi -dmenu -show-icons -p Name -i -mesg "$mesg" ${bindings[@]} < "$CACHE_ROFI")"

on_rofi_exit "$?" "$bookmark"
