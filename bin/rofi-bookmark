#!/usr/bin/env bash
export CACHE_DIR="${XDG_CACHE_DIR:-$HOME/.cache}/bookmarks"
export CACHE_ROFI="$CACHE_DIR/rofi"

bindings=(
	-kb-custom-1 Alt+e
	-kb-custom-2 Alt+c
)
mesg="<b>${bindings[1]}</b>: edit, <b>${bindings[3]}</b>: clip"

#TODO:
# set -e

open() {
	bookmark open "$1"
}

clip() {
	bookmark clip "$1"
}

edit() {
	export BOOKMARK="$1"
	"$TERMINAL" -e sh -c 'bookmark edit "$BOOKMARK"'
}

on_rofi_exit() {
	if [ -n "$1" ]; then
		case "$1" in
			0)  open "$bookmark";;
			10) edit "$bookmark";;
			11) clip "$bookmark";;
			*) exit "$1";;
		esac
	fi
}

case "$1" in
	download) shift; rofi-bookmark-download.py "$@"; exit ;;
	*) ;;
esac

bookmark="$(rofi -dmenu -show-icons -p Name -i -mesg "$mesg" ${bindings[@]} < "$CACHE_ROFI")"

on_rofi_exit "$?" "$bookmark"
